{"version":3,"file":"tunnel.js","mappings":"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","sources":["webpack://smartdesign/webpack/universalModuleDefinition","webpack://smartdesign/./common/uuid.ts","webpack://smartdesign/./tunnel/broadcastchannel.ts","webpack://smartdesign/webpack/bootstrap","webpack://smartdesign/./tunnel/tunnel.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"smartdesign\"] = factory();\n\telse\n\t\troot[\"smartdesign\"] = factory();\n})(self, function() {\nreturn ","export const UUID = (): string => {\n    if (typeof window.crypto !== \"undefined\" && typeof window.crypto.getRandomValues !== \"undefined\") {\n        // If we have a cryptographically secure PRNG, use that\n        // http://stackoverflow.com/questions/6906916/collisions-when-generating-uuids-in-javascript\n        const buf = new Uint16Array(8);\n        window.crypto.getRandomValues(buf);\n        const S4 = (num: number) => {\n            let ret = num.toString(16);\n            while (ret.length < 4) {\n                ret = \"0\" + ret;\n            }\n            return ret;\n        };\n        return (\n            S4(buf[0]) +\n            S4(buf[1]) +\n            \"-\" +\n            S4(buf[2]) +\n            \"-\" +\n            S4(buf[3]) +\n            \"-\" +\n            S4(buf[4]) +\n            \"-\" +\n            S4(buf[5]) +\n            S4(buf[6]) +\n            S4(buf[7])\n        );\n    } else {\n        const s4 = () => {\n            return Math.floor((1 + Math.random()) * 0x10000)\n                .toString(16)\n                .substring(1);\n        };\n        return s4() + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" + s4() + s4() + s4();\n    }\n};\n","import { IEndpoint } from \"../common/communicator\";\nimport { UUID } from \"../common/uuid\";\n\nexport class BroadcastChannelPolyfill implements IEndpoint {\n    private listeners: Array<(message) => void> = [];\n    private storage = window.localStorage;\n    private prefix: string;\n    private listening = true;\n    private _tabId = UUID();\n    constructor(channelID: string) {\n        this.prefix = \"__sd_interop_\" + channelID;\n        window.addEventListener(\"storage\", (e) => {\n            if (!this.listening) {\n                return;\n            }\n            if (e.key.indexOf(this.prefix) === 0) {\n                try {\n                    const data = JSON.parse(e.newValue);\n                    if (data._tabId !== this._tabId) {\n                        this.listeners.forEach((listener) => {\n                            listener({ data: e.newValue });\n                        });\n                    }\n                } catch (error) {\n                    console.error(\"An exception occurred while receiving a broadcasted message!\");\n                }\n            }\n        });\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public postMessage(message: any): void {\n        const key = this.prefix + UUID();\n        this.listening = false;\n        try {\n            if (this.storage.getItem(key) === null) {\n                const data = JSON.parse(message);\n                data._tabId = this._tabId;\n                this.storage.setItem(key, JSON.stringify(data));\n                this.storage.removeItem(key);\n            }\n        } catch (error) {\n            console.error(\"Broadcast polyfill can not function properly!\");\n        }\n        this.listening = true;\n    }\n    public addEventListener(type: string, listener: (message) => void): void {\n        if (type === \"message\") {\n            this.listeners.push(listener);\n        }\n    }\n    public removeEventListener(type: string, listener: (message) => void): void {\n        if (type === \"message\") {\n            const index = this.listeners.indexOf(listener);\n            if (index > -1) {\n                this.listeners.splice(index);\n            }\n        }\n    }\n}\n\nexport interface IBroadCastEndpoint {\n    postMessage(message: unknown): void;\n    addEventListener(type: string, listener: (message) => void, options?: boolean | AddEventListenerOptions): void;\n    removeEventListener(type: string, listener: (message) => void, options?: boolean | AddEventListenerOptions): void;\n}\n\nexport const createBroadcastEndPoint = (channelID: string): IBroadCastEndpoint => {\n    if (\"BroadcastChannel\" in window) {\n        return new BroadcastChannel(channelID);\n    }\n    return new BroadcastChannelPolyfill(channelID);\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { SDMessage } from \"../common/sdmessage\";\nimport { createBroadcastEndPoint } from \"./broadcastchannel\";\nimport { UUID } from \"../common/uuid\";\n\nconst whitelist = [window.location.origin, \"WHITELIST\"];\nconst interop = createBroadcastEndPoint(\"smartdesign-interop\");\nconst referrer = new URL(document.referrer);\nconst myOrigin = referrer.origin;\nconst tunnelInstanceID = UUID();\n\ninterop.addEventListener(\"message\", (e: MessageEvent) => {\n    if (whitelist.indexOf(myOrigin) > -1) {\n        try {\n            const message: SDMessage = e.data ? (JSON.parse(e.data) as SDMessage) : undefined;\n            if ((message && message.target == null) || message.target === tunnelInstanceID) {\n                window.parent.postMessage(JSON.stringify(message), myOrigin);\n            }\n        } catch (error) {\n            console.error(\"An exception occurred while broadcasting the message!\");\n        }\n    }\n});\n\nwindow.addEventListener(\"message\", (e) => {\n    if (whitelist.indexOf(e.origin) > -1) {\n        const message: SDMessage = e.data ? (JSON.parse(e.data) as SDMessage) : undefined;\n        if (message) {\n            if (message.payload) {\n                message.payload.origin = e.origin;\n            }\n            if (message.source == null) {\n                message.source = tunnelInstanceID;\n            } else {\n                const sender = message.source;\n                message.source = tunnelInstanceID;\n                message.target = sender;\n            }\n            interop.postMessage(JSON.stringify(message));\n        }\n    }\n});\n\nwindow.parent.postMessage(\"ready\", myOrigin);\n"],"names":["root","factory","exports","module","define","amd","self","window","crypto","getRandomValues","buf","Uint16Array","S4","num","ret","toString","length","s4","Math","floor","random","substring","uuid_1","require","BroadcastChannelPolyfill","channelID","_this","this","listeners","storage","localStorage","listening","_tabId","UUID","prefix","addEventListener","e","key","indexOf","JSON","parse","newValue","forEach","listener","data","error","console","prototype","postMessage","message","getItem","setItem","stringify","removeItem","type","push","removeEventListener","index","splice","BroadcastChannel","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","broadcastchannel_1","whitelist","location","origin","interop","createBroadcastEndPoint","myOrigin","URL","document","referrer","tunnelInstanceID","target","parent","payload","source","sender"],"sourceRoot":""}